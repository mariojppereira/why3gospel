
(library
  (public_name why3gospel)
  (flags :standard -w -9-32-27)
  (modules why3gospel)
  (libraries compiler-libs why3 gospel))

;; cf https://discuss.ocaml.org/t/dune-problems-using-dynlink-plugins/2874
(rule
  (targets real_why3gospel.cmxs)
  (deps why3gospel.cmxa)
  (action (run ocamlfind ocamlopt
                  -shared
                  -linkall
                  -linkpkg
                  -package compiler-libs,why3,gospel
                  %{deps}
                  -o %{targets}
  )))

(install
  (section lib_root)
  (files
   (real_why3gospel.cmxs as why3/plugins/real_why3gospel.cmxs))
  (package why3gospel))
